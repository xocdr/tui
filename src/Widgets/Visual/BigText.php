<?php

declare(strict_types=1);

namespace Xocdr\Tui\Widgets\Visual;

use Xocdr\Tui\Components\Box;
use Xocdr\Tui\Components\BoxColumn;
use Xocdr\Tui\Components\BoxRow;
use Xocdr\Tui\Components\Component;
use Xocdr\Tui\Components\Text;
use Xocdr\Tui\Widgets\Widget;

class BigText extends Widget
{
    private string $text = '';

    private string $font = 'block';

    private ?string $color = null;

    /** @var array<string>|null */
    private ?array $gradient = null;

    private string $align = 'left';

    private const FONTS = [
        'block' => [
            'A' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ'],
            'B' => ['â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆ '],
            'C' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆ    ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'D' => ['â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆ '],
            'E' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'F' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆ ', 'â–ˆ    ', 'â–ˆ    '],
            'G' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆ  â–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'H' => ['â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ'],
            'I' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '  â–ˆ  ', '  â–ˆ  ', '  â–ˆ  ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'J' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', '    â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'K' => ['â–ˆ   â–ˆ', 'â–ˆ  â–ˆ ', 'â–ˆâ–ˆâ–ˆ  ', 'â–ˆ  â–ˆ ', 'â–ˆ   â–ˆ'],
            'L' => ['â–ˆ    ', 'â–ˆ    ', 'â–ˆ    ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'M' => ['â–ˆ   â–ˆ', 'â–ˆâ–ˆ â–ˆâ–ˆ', 'â–ˆ â–ˆ â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ'],
            'N' => ['â–ˆ   â–ˆ', 'â–ˆâ–ˆ  â–ˆ', 'â–ˆ â–ˆ â–ˆ', 'â–ˆ  â–ˆâ–ˆ', 'â–ˆ   â–ˆ'],
            'O' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'P' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆ    '],
            'Q' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ  â–ˆ ', 'â–ˆâ–ˆâ–ˆ â–ˆ'],
            'R' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ  â–ˆ ', 'â–ˆ   â–ˆ'],
            'S' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'T' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '  â–ˆ  ', '  â–ˆ  ', '  â–ˆ  ', '  â–ˆ  '],
            'U' => ['â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            'V' => ['â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', ' â–ˆ â–ˆ ', '  â–ˆ  '],
            'W' => ['â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆ â–ˆ â–ˆ', 'â–ˆâ–ˆ â–ˆâ–ˆ', 'â–ˆ   â–ˆ'],
            'X' => ['â–ˆ   â–ˆ', ' â–ˆ â–ˆ ', '  â–ˆ  ', ' â–ˆ â–ˆ ', 'â–ˆ   â–ˆ'],
            'Y' => ['â–ˆ   â–ˆ', ' â–ˆ â–ˆ ', '  â–ˆ  ', '  â–ˆ  ', '  â–ˆ  '],
            'Z' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '   â–ˆ ', '  â–ˆ  ', ' â–ˆ   ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '0' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ  â–ˆâ–ˆ', 'â–ˆ â–ˆ â–ˆ', 'â–ˆâ–ˆ  â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '1' => [' â–ˆâ–ˆ  ', '  â–ˆ  ', '  â–ˆ  ', '  â–ˆ  ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '2' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '3' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '4' => ['â–ˆ   â–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', '    â–ˆ'],
            '5' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '6' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ    ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '7' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', '   â–ˆ ', '  â–ˆ  ', '  â–ˆ  '],
            '8' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            '9' => ['â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', 'â–ˆ   â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '    â–ˆ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ'],
            ' ' => ['     ', '     ', '     ', '     ', '     '],
            '!' => ['  â–ˆ  ', '  â–ˆ  ', '  â–ˆ  ', '     ', '  â–ˆ  '],
            '.' => ['     ', '     ', '     ', '     ', '  â–ˆ  '],
            '-' => ['     ', '     ', 'â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ', '     ', '     '],
        ],
        'mini' => [
            'A' => ['{ {', '#+', 'y y'],
            'B' => [' ', '#;', ''],
            'C' => ['x', '  ', 'x'],
            'D' => ['3x', ' ', ';x'],
            'E' => ['x', '#x ', 'x'],
            'F' => ['x', '#x ', 'y  '],
            'G' => ['x', 'z', ''],
            'H' => ['{ {', '#+', 'y y'],
            'I' => ['{', '', 'y'],
            'J' => ['  {', '  ', ''],
            'K' => ['{ {', '#;x', 'y y'],
            'L' => ['{  ', '  ', 'x'],
            'M' => ['3', '', 'y y'],
            'N' => ['{', '+', 'y y'],
            'O' => ['', ' ', ''],
            'P' => ['', '#', 'y  '],
            'Q' => ['', ' ', ';'],
            'R' => ['', '#3', 'yx'],
            'S' => ['x', '', 'z'],
            'T' => ['z3x', '  ', ' y '],
            'U' => ['{ {', ' ', ''],
            'V' => ['{ {', ' ', ' y '],
            'W' => ['{ {', '', ';'],
            'X' => ['{ {', ' K ', 'y y'],
            'Y' => ['{ {', ' K ', ' y '],
            'Z' => ['z', ' ', 'z;x'],
            '0' => ['', ' ', ''],
            '1' => ['z ', '  ', 'z;x'],
            '2' => ['z', '', 'x'],
            '3' => ['z', ' +', 'z'],
            '4' => ['{ {', '+', '  y'],
            '5' => ['x', '', 'z'],
            '6' => ['x', '#', ''],
            '7' => ['z', '  ', '  y'],
            '8' => ['', '#+', ''],
            '9' => ['', '+', 'z'],
            ' ' => ['   ', '   ', '   '],
            '!' => ['{', 'y', 'y'],
            '.' => [' ', ' ', 'y'],
            '-' => ['   ', 'zx', '   '],
        ],
    ];

    private function __construct()
    {
    }

    public static function create(string $text = ''): self
    {
        $instance = new self();
        $instance->text = $text;

        return $instance;
    }

    public function text(string $text): self
    {
        $this->text = $text;

        return $this;
    }

    public function font(string $font): self
    {
        $this->font = $font;

        return $this;
    }

    public function color(string $color): self
    {
        $this->color = $color;

        return $this;
    }

    /**
     * @param array<string> $colors
     */
    public function gradient(array $colors): self
    {
        $this->gradient = $colors;

        return $this;
    }

    public function align(string $align): self
    {
        $this->align = $align;

        return $this;
    }

    public function build(): Component
    {
        $font = self::FONTS[$this->font] ?? self::FONTS['block'];
        $chars = mb_str_split(strtoupper($this->text));
        $lineCount = count($font['A'] ?? $font[' '] ?? []);
        $lines = array_fill(0, $lineCount, '');

        foreach ($chars as $char) {
            $charLines = $font[$char] ?? $font[' '] ?? array_fill(0, $lineCount, '     ');
            foreach ($charLines as $i => $line) {
                $lines[$i] .= $line . ' ';
            }
        }

        $elements = [];
        foreach ($lines as $line) {
            $text = new Text(rtrim($line));
            if ($this->color !== null) {
                $text = $text->color($this->color);
            }
            $elements[] = $text;
        }

        return new BoxColumn($elements);
    }
}
